services:
  create_db:
    image: watgpt:latest
    container_name: watgpt_container
    volumes:
      - ./wat_data:/home/wat_data
      - ./databases:/home/databases
    ports:
      - "8000:8000"
    environment:
      - PYTHONPATH=/home
      - GROQ_API_KEY=your_key_here
    command: 
      - sh
      - -c
      - |
        poetry run python -m watgpt.scripts.create_sql_db
        echo "test"
        echo 'âœ… 1) DB created...'
        echo 'ğŸ•·ï¸ 2) Starting Scrapy...'
        poetry run python -m watgpt.scripts.scrape
        echo 'âœ… 2) Scraping done...'
        echo 'ğŸ—„ï¸ 3) Creating vector DB...'
        poetry run python -m watgpt.scripts.create_vector_db
        echo 'âœ… 3) Vector DB created...'
        echo 'ğŸš€ 4) Starting FastAPI...'
        poetry run uvicorn watgpt.api:app --host 0.0.0.0 --port 8000